#!/bin/sh

ICAO="${BLOCK_INSTANCE:-NWWW}"
SITE="http://weather.noaa.gov/weather/current/$ICAO.html"
NOAA="$(curl -s "$SITE")"

TEMPERATURE="$(echo "$NOAA" | grep -Po '(?<=\().*(?=\))' | grep -m1 " C")"
CONDITION="$(echo "$NOAA" | sed -n '/Sky/{n;n;p;q}' | cut -d" " -f4,5)"

if [ -n "$CONDITION" ] && [ -n "$TEMPERATURE" ] ; then
    echo "$CONDITION [$TEMPERATURE]"
elif [ -z "$CONDITION" ] && [ -n "$TEMPERATURE" ]; then
    echo "$TEMPERATURE"
fi

[ "$BLOCK_BUTTON" -eq 1 ] && chromium "$SITE" &
